<!DOCTYPE html>
<html lang="en">
<head>
   <%- include('./partials/head') %>
    <title><%= blog.title %> - BlogUp</title>
</head>
<body>
   <%- include('./partials/nav') %>
   
   <div class="blog-container">
      <article>
         <header class="blog-header">
            <h1 class="blog-title"><%= blog.title %></h1>
            
            <% if (blog.summary) { %>
               <div class="alert alert-info mt-3" role="alert">
                  <strong>âœ¨ AI Summary:</strong> <%= blog.summary %>
               </div>
            <% } %>
            
            <div class="blog-author">
               <img src="<%= blog.createdBy.profileImage %>" alt="<%= blog.createdBy.fullName %>" />
               <div>
                  <h3 class="blog-author-name"><%= blog.createdBy.fullName %></h3>
               </div>
            </div>
         </header>

         <% if (blog.coverImageUrl) { %>
            <img src="<%= blog.coverImageUrl %>" alt="<%= blog.title %>" class="blog-cover" />
         <% } %>

         <div class="blog-content">
            <pre><%= blog.body %></pre>
         </div>
      </article>

      <section class="comments-section">
         <h2 class="comments-title">
            <%= comments.length %> <%= comments.length === 1 ? 'Comment' : 'Comments' %>
         </h2>

         <% if (locals.user) { %> 
            <form id="commentForm" action="/blog/comment/<%= blog._id %>" method="post" class="comment-form">
               <div class="comment-form-header">
                  <img src="<%= user.profileImageURL && user.profileImageURL.startsWith('.') ? user.profileImageURL.slice(1) : (user.profileImageURL || '/images/avatar.avif') %>" alt="Your avatar" />
                  <div style="flex-grow: 1;">
                     <textarea 
                        id="commentInput" 
                        name="content" 
                        rows="4" 
                        placeholder="Share your thoughts..."
                        required></textarea>
                  </div>
               </div>
               <div class="comment-form-actions">
                  <button type="button" class="btn-modern-outline" onclick="document.getElementById('commentForm').reset();">Cancel</button>
                  <button type="submit" class="btn-modern">Post Comment</button>
               </div>
            </form>
         <% } %>

         <div class="comments-list">
            <% if (comments && comments.length > 0) { %>
               <% comments.forEach(comment => { %>
                  <div class="comment-item">
                     <img 
                        src="<%= comment.createdBy.profileImage %>" 
                        alt="<%= comment.createdBy.fullName %>" 
                        class="comment-avatar" />
                     <div class="comment-content">
                        <h5 class="comment-author"><%= comment.createdBy.fullName %></h5>
                        <p class="comment-text"><%= comment.content %></p>
                     </div>
                  </div>
               <% }) %>
            <% } else { %>
               <p class="text-muted text-center py-4">No comments yet. Be the first to share your thoughts!</p>
            <% } %>
         </div>
      </section>
   </div>

   <%- include('./partials/script') %>
</body>
</html>